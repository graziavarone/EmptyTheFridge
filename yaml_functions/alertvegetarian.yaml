metadata:
  name: alertvegetarian
  labels:
    nuclio.io/project-name: 8226f05d-5d61-44ba-bbea-899e4f1c3d6f
spec:
  handler: handler
  runtime: nodejs
  env:
    - name: API_KEY
      value: {YOUR_API_KEY}
  resources: {}
  image: "nuclio/processor-alertvegetarian:latest"
  minReplicas: 1
  maxReplicas: 1
  triggers:
    myMqttTrigger:
      class: ""
      kind: mqtt
      url: "guest:guest@{YOUR_IP}:1883"
      attributes:
        subscriptions:
          - qos: 0
            topic: iot/alertVeg
  version: 1
  build:
    functionSourceCode: dmFyIHJlcXVlc3QgPSByZXF1aXJlKCdyZXF1ZXN0JykNCg0KY29uc3QgQVBJX0tFWSA9IHByb2Nlc3MuZW52LkFQSV9LRVkNCg0KZnVuY3Rpb24gc2VuZE1haWwoaW5ncmVkaWVudCwgbWVzc2FnZUZvcm1hdHRlZCkgew0KICAgIHJlcXVlc3Qoew0KICAgICAgICB1cmw6ICcgaHR0cHM6Ly9tYWtlci5pZnR0dC5jb20vdHJpZ2dlci9hbGVydFZlZy93aXRoL2tleS8nK0FQSV9LRVksDQogICAgICAgIHFzOiB7DQogICAgICAgICAgICAidmFsdWUxIjogaW5ncmVkaWVudCwNCiAgICAgICAgICAgICJ2YWx1ZTIiOiBtZXNzYWdlRm9ybWF0dGVkLA0KDQogICAgICAgIH0sDQogICAgICAgIG1ldGhvZDogJ1BPU1QnLA0KICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nDQogICAgICAgIH0NCiAgICB9LCBmdW5jdGlvbiAoZXJyb3IsIHJlc3BvbnNlLCBib2R5KSB7DQogICAgICAgIGlmIChlcnJvcikgew0KICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2Uuc3RhdHVzQ29kZSwgYm9keSk7DQogICAgICAgIH0NCiAgICB9KTsNCn0NCg0KZnVuY3Rpb24gYmluMnN0cmluZyhhcnJheSkgew0KICAgIHZhciByZXN1bHQgPSAiIjsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgKytpKSB7DQogICAgICAgIHJlc3VsdCArPSAoU3RyaW5nLmZyb21DaGFyQ29kZShhcnJheVtpXSkpOw0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KfQ0KDQpmdW5jdGlvbiBzcGxpdF9yZWNpcGVzKG1lc3NhZ2UpIHsNCiAgICBjb25zdCByZWNpcGVzID0gbWVzc2FnZS5zcGxpdCgnXG4nKS5tYXAoeCA9PiB4LnRyaW0oKSk7DQogICAgcmV0dXJuIHJlY2lwZXM7DQp9DQoNCmZ1bmN0aW9uIGZvcm1hdF9tZXNzYWdlKHJlY2lwZXMpIHsNCiAgICBsZXQgbWVzc2FnZUZvcm1hdHRlZCA9ICcnDQogICAgZm9yIChpID0gMDsgaSA8IHJlY2lwZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgbWVzc2FnZUZvcm1hdHRlZCA9IG1lc3NhZ2VGb3JtYXR0ZWQgKyByZWNpcGVzW2ldICsgIjxicj4iDQogICAgfQ0KICAgIHJldHVybiBtZXNzYWdlRm9ybWF0dGVkOw0KfQ0KDQpleHBvcnRzLmhhbmRsZXIgPSBmdW5jdGlvbiAoY29udGV4dCwgZXZlbnQpIHsNCiAgICB2YXIgX2V2ZW50ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShldmVudCkpOw0KICAgIHZhciBfZGF0YSA9IGJpbjJzdHJpbmcoX2V2ZW50LmJvZHkuZGF0YSk7DQogICAgY29udGV4dC5jYWxsYmFjaygiZmVlZGJhY2sgIiArIF9kYXRhKTsNCiAgICBjb25zdCBtZXNzYWdlV2l0aEluZ3JlZGllbnQgPSBfZGF0YS5zcGxpdCgnLCcpLm1hcCh4ID0+IHgudHJpbSgpKTsNCiAgICBpZiAobWVzc2FnZVdpdGhJbmdyZWRpZW50WzFdICE9PSAnJykgew0KICAgICAgICBjb25zb2xlLmxvZygiU2VuZGluZyBhbiBlbWFpbCIpDQogICAgICAgIGNvbnN0IHJlY2lwZXMgPSBzcGxpdF9yZWNpcGVzKG1lc3NhZ2VXaXRoSW5ncmVkaWVudFsxXSkNCiAgICAgICAgY29uc3QgbWVzc2FnZUZvcm1hdHRlZCA9IGZvcm1hdF9tZXNzYWdlKHJlY2lwZXMpDQogICAgICAgIHNlbmRNYWlsKG1lc3NhZ2VXaXRoSW5ncmVkaWVudFswXSwgbWVzc2FnZUZvcm1hdHRlZCk7DQogICAgfQ0KDQp9Ow==
    commands:
      - 'npm install request'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 60
